# OrbitPouchStore

[![stability](https://img.shields.io/badge/stability-experimental-orange.svg?style=flat-square)](https://nodejs.org/api/documentation.html#documentation_stability_index)
[![npm version](https://img.shields.io/npm/v/@garbados/orbit-pouch-store.svg?style=flat-square)](https://www.npmjs.com/package/orbit-pouch-store)
[![js-standard-style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg?style=flat-square)](https://github.com/feross/standard)
[![build status](https://img.shields.io/travis/garbados/orbit-pouch-store/master.svg?style=flat-square)](https://travis-ci.org/garbados/orbit-pouch-store)
[![test coverage](https://img.shields.io/coveralls/github/garbados/orbit-pouch-store/master.svg?style=flat-square)](https://coveralls.io/github/garbados/orbit-pouch-store)
[![greenkeeper](https://badges.greenkeeper.io/garbados/orbit-pouch-store.svg)](https://greenkeeper.io/)

An [OrbitDB](https://github.com/orbitdb/orbit-db) store that uses [PouchDB](https://pouchdb.com/) for indexing, allowing you to perform flexible [mango](https://pouchdb.com/guides/mango-queries.html) queries. It extends [orbit-db-docstore](https://github.com/orbitdb/orbit-db-docstore).

## Why?

OrbitDB is a distributed database that stores records as [IPFS blocks](https://github.com/ipfs/interface-ipfs-core/blob/master/SPEC/BLOCK.md) so that they can be 1) de-duplicated 2) replicated with peers. You can get and share OrbitDB stores by sharing their address, and you can create subsets of your data that peer from users that have the same blocks, even if those blocks aren't part of the same subset or even of the same originating data.

However, OrbitDB's default stores provide only rudimentary indexing, limiting the queries you can make of your data. So, I created a store that used PouchDB for indexing.

OrbitPouchStore is an OrbitDB store that uses a PouchDB instance to index its oplog. That allows you to perform [mango](https://pouchdb.com/guides/mango-queries.html) queries and [map/reduce](https://pouchdb.com/guides/queries.html) queries, among other neat things.

I hope you find it useful!

## Install

Install using [npm](https://www.npmjs.com):

```bash
npm i -S orbit-pouch-store
```

Now you can use it with OrbitDB:

```javascript
// 1. add pouch as a store type
const OrbitPouchStore = require('orbit-pouch-store')
OrbitDB.addType('pouch', OrbitPouchStore)

// 2. once you have an orbitdb instance, create the store
const pouch = await orbitdb.create('my-app', 'pouch', options)

// 3. do the thing!
let result = await pouch.put({ greetings: 'hello world' })
let doc = await pouch.get(result.id)
console.log(doc.greetings)
> hello world
```

## Usage

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [OrbitPouchStore](#orbitpouchstore)
    -   [all](#all)
    -   [find](#find)
    -   [query](#query)
    -   [get](#get)
    -   [del](#del)
    -   [stop](#stop)
    -   [db](#db)
    -   [Index](#index)
    -   [type](#type)
-   [PouchIndex](#pouchindex)
    -   [get](#get-1)
    -   [find](#find-1)
    -   [query](#query-1)
    -   [db](#db-1)

### OrbitPouchStore

**Extends OrbitDocStore**

OrbitPouchStore - an OrbitDB store indexed by PouchDB

Generally, you will not instantiate this class directly
unless you are extending it.
Instead, you'll probably use it like this:

    // when your app starts:
    OrbitDB.addType(OrbitPouchStore.type, OrbitPouchStore)
    // then, once you have an orbitdb instance:
    let pouch = orbitdb.create(dbName, 'pouch')

**Parameters**

-   `ipfs` **IPFS** An instance of an IPFS node.
-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Name of the store, ex: 'blog' or 'test'
-   `address` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Address for the store's IPFS feed. Optional.
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Options object passed through to OrbitDocStore. (optional, default `{}`)

#### all

Retrieves all documents in the database.

    await store.all()
    // [{ _id: '...', _rev: '...', ...}, ...]

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

#### find

Perform a [mango query](https://pouchdb.com/guides/mango-queries.html).

**Parameters**

-   `query` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Same as the first parameter for [PouchDB#find](https://pouchdb.com/api.html#query_index)

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** An array of the documents that matched the query.

#### query

Performs a [map/reduce query](https://pouchdb.com/guides/queries.html).

**Parameters**

-   `query` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Same as the first parameter for [PouchDB#query](https://pouchdb.com/api.html#query_database)
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** [{}] Same as the second parameter for [PouchDB#query](https://pouchdb.com/api.html#query_database) (optional, default `{}`)

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

#### get

Retrieve a document by ID. Without an ID, defaults to retrieving all documents.

Get a single doc:

    await store.get(id)
    > { _id: '...', _rev: '...', name: 'Mario' }

Get all docs:

    await store.get()
    > [{ _id: '...', _rev: '...', name: 'Mario' }, ...]

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The ID of the document to retrieve.

Returns **([Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array))** 

#### del

Deletes the document with the given ID.

    await store.del(id)
    > { ok: true }

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The '\_id' value of the document to delete.

#### stop

Stop the store and close its resources.

    store.stop().then(() => {
      // store has been closed
    })

#### db

Getter for the PouchDB instance used by the index.

    store.db

Returns **PouchDB** 

#### Index

Static getter that returns the class of index
used by this store.

    OrbitPouchStore.Index

Returns **[PouchIndex](#pouchindex)** 

#### type

Returns the canonical name of this store, `'pouch'`.
Useful if you'd rather not type in a raw string.

    OrbitPouchStore.type

Returns **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### PouchIndex

[PouchIndex description]

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** [description]
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** [description] (optional, default `{}`)

#### get

Retrieve a document by ID. Without an ID, defaults to retrieving all documents.

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The ID of the document to retrieve.

Returns **([Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array))** 

#### find

Perform a [mango query](https://pouchdb.com/guides/mango-queries.html).

**Parameters**

-   `query` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Same as the first parameter for [PouchDB#find](https://pouchdb.com/api.html#query_index)

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** An array of the documents that matched the query.

#### query

Performs a [map/reduce query](https://pouchdb.com/guides/queries.html).

**Parameters**

-   `query` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Same as the first parameter for [PouchDB#query](https://pouchdb.com/api.html#query_database)
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** [{}] Same as the second parameter for [PouchDB#query](https://pouchdb.com/api.html#query_database) (optional, default `{}`)

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

#### db

Getter for the index's PouchDB instance.

Returns **PouchDB** 

## Contributing

This library is experimental. All contributions are welcome: bug reports, feature requests, "why doesn't this work" questions, pull requests for fixes and features, etc. For all of the above, [file an issue](https://github.com/garbados/orbit-pouch-store/issues) or [submit a pull request](https://github.com/garbados/orbit-pouch-store/pulls).

## License

[Apache-2.0](https://www.apache.org/licenses/LICENSE-2.0)
